<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
    <title>Lion Parade Da Nang</title>
    <style>
        /* Using dvh (Dynamic Viewport Height) prevents mobile browser bars from clipping the bottom */
        body { 
            margin:0; 
            background:#FFF5E1; 
            font-family:sans-serif; 
            overflow:hidden; 
            height: 100vh;
            height: 100dvh; 
            display:flex; 
            flex-direction:column; 
        }
        
        #bg-fx { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10001; }
        .bubble { position: absolute; border-radius: 50%; bottom: -50px; animation: rise linear forwards; opacity: 0.6; border: 1px solid white; }
        @keyframes rise { 100% { transform: translateY(-110vh); } }

        /* HEADER AREA - More compact to give room to UI */
        #header-zone {
            width: 100%; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            padding: 15px 0; 
            box-sizing: border-box; 
            position: relative; 
            z-index: 50;
        }

        /* BIGGER CAMERA */
        #camera-bubble { 
            width: 240px; 
            height: 240px; 
            border-radius: 50%; 
            border: 8px solid white; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.2); 
            overflow: hidden; 
            background: #000;
            margin-bottom: 10px;
        }
        video { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }

        #goal-bar { 
            display: flex; 
            gap: 12px; 
            background: rgba(255,255,255,0.8); 
            padding: 6px 15px; 
            border-radius: 20px; 
            backdrop-filter: blur(10px);
        }
        .goal-lion { width: 25px; height: 25px; filter: grayscale(1) opacity(0.3); transition: 0.5s; }
        .active-goal { filter: grayscale(0) opacity(1) drop-shadow(0 0 8px gold) !important; transform: scale(1.3); }

        /* LIONS AT THE VERY FRONT */
        #lion-stage { 
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; 
            pointer-events: none; 
            z-index: 9999; 
        }
        .lion-wrap {
            position: absolute; bottom: -250px; width: 180px; height: 180px;
            transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .lion-up { transform: translateY(-75vh); } 
        
        .lion-img { position: absolute; width: 100%; height: 100%; object-fit: contain; }
        .mouth-on .img-1 { animation: swap 0.4s infinite; }
        .mouth-on .img-2 { animation: swap 0.4s infinite reverse; }
        @keyframes swap { 0%, 45% { opacity: 1; } 50%, 100% { opacity: 0; } }

        /* UI PANEL - PINNED TO BOTTOM */
        .ui-panel { 
            margin-top: auto; 
            background: white; 
            border-radius: 30px 30px 0 0; 
            padding: 20px 20px calc(20px + env(safe-area-inset-bottom)); 
            z-index: 100; 
            box-shadow: 0 -10px 30px rgba(0,0,0,0.1); 
            text-align: center;
        }
        .btn { 
            width: 100%; padding: 16px; margin-bottom: 10px; border: 3px solid #5D4037; 
            border-radius: 12px; font-weight: bold; font-size: 18px; background: white; 
            box-shadow: 0 4px 0 #5D4037; transition: 0.1s; 
            pointer-events: auto; cursor: pointer; outline: none;
        }
        .btn:active { transform: translateY(2px); box-shadow: 0 2px 0 #5D4037; }
        .btn.selected { background: #A2D2FF !important; }
        .btn.correct { background: #B9FBC0 !important; border-color: #2D6A4F !important; }
        .btn.wrong { background: #FFADAD !important; animation: shake 0.4s; }
        @keyframes shake { 0%, 100% { transform:translateX(0); } 25% { transform:translateX(-5px); } 75% { transform:translateX(5px); } }
    </style>
</head>
<body>

    <div id="bg-fx"></div>

    <div id="header-zone">
        <div id="camera-bubble">
            <video id="v" autoplay playsinline muted></video>
        </div>
        <div id="goal-bar">
            <img src="lion-1.png" id="g0" class="goal-lion">
            <img src="lion-1.png" id="g1" class="goal-lion">
            <img src="lion-1.png" id="g2" class="goal-lion">
        </div>
    </div>

    <div class="ui-panel">
        <div id="start-screen">
            <h1 style="color:#5D4037; margin:0 0 5px 0; font-size: 24px;">Lion Parade</h1>
            <p style="color:#8D6E63; margin-bottom: 15px; font-size: 14px;">Win to see the lions dance!</p>
            <button class="btn" onclick="init()">START GAME</button>
        </div>
        <div id="game-area" style="display:none">
            <h2 id="question" style="font-size: 18px; margin-bottom: 15px; color: #5D4037;">Question?</h2>
            <div id="options"></div>
        </div>
    </div>

    <div id="lion-stage"></div>

<script>
    const data = [
        {q:"Which bridge in Da Nang breathes fire?", a:["Han River Bridge","Dragon Bridge","Tran Thi Ly"], c:1},
        {q:"What color is the 'Lucky Envelope'?", a:["Yellow","Red","Blue"], c:1},
        {q:"Is the Lion Dance for good luck?", a:["Yes","No","Maybe"], c:0}
    ];

    let currentQ = 0; let wins = 0;
    const colors = ["#FFB7B2", "#FFD700", "#FF4D4D", "#B2E2F2"];

    async function init() {
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('game-area').style.display = 'block';
        
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: "user", width: { ideal: 640 }, height: { ideal: 640 } } 
                });
                const v = document.getElementById('v');
                v.srcObject = stream;
                v.onloadedmetadata = () => v.play();
            } catch (e) {
                console.warn("Camera access denied.");
            }
        }
        loadQ();
    }

    function loadQ() {
        const item = data[currentQ];
        document.getElementById('question').innerText = item.q;
        const zone = document.getElementById('options');
        zone.innerHTML = '';
        item.a.forEach((txt, i) => {
            const b = document.createElement('button');
            b.className = 'btn'; b.innerText = txt;
            b.onclick = () => handle(b, i, item.c);
            zone.appendChild(b);
        });
    }

    function handle(btn, choice, right) {
        const buttons = document.querySelectorAll('.btn');
        buttons.forEach(b => b.style.pointerEvents = 'none');
        btn.classList.add('selected');

        setTimeout(() => {
            btn.classList.remove('selected');
            if(choice === right) {
                btn.classList.add('correct');
                if(wins < 3) {
                    document.getElementById(`g${wins}`).classList.add('active-goal');
                    wins++;
                }
                celebrate();
            } else {
                btn.classList.add('wrong');
                setTimeout(() => {
                    btn.classList.remove('wrong');
                    buttons.forEach(b => b.style.pointerEvents = 'auto');
                }, 800);
            }
        }, 800);
    }

    function celebrate() {
        const stage = document.getElementById('lion-stage');
        stage.innerHTML = '';
        for(let i=0; i<wins; i++) {
            const w = document.createElement('div');
            w.className = 'lion-wrap mouth-on';
            w.style.left = `calc(${(100/(wins+1))*(i+1)}% - 90px)`;
            w.innerHTML = `<img src="lion-1.png" class="lion-img img-1" style="opacity:1"><img src="lion-2.png" class="lion-img img-2" style="opacity:0">`;
            stage.appendChild(w);
            setTimeout(() => w.classList.add('lion-up'), 50);
        }

        setTimeout(() => {
            document.querySelectorAll('.lion-wrap').forEach(l => l.classList.remove('lion-up'));
            setTimeout(() => {
                currentQ++;
                if(currentQ < data.length) {
                    loadQ();
                } else {
                    document.getElementById('question').innerText = "Winner! ðŸ†";
                    document.getElementById('options').innerHTML = '<button class="btn" onclick="location.reload()">REPLAY</button>';
                }
            }, 800);
        }, 3000);
    }

    setInterval(() => {
        const b = document.createElement('div');
        b.className = 'bubble';
        const s = Math.random()*20+15;
        b.style.width = b.style.height = s+"px";
        b.style.left = Math.random()*100+"vw";
        b.style.background = colors[Math.floor(Math.random()*colors.length)];
        b.style.animationDuration = (Math.random()*3+2)+"s";
        document.getElementById('bg-fx').appendChild(b);
        setTimeout(() => b.remove(), 5000);
    }, 450);
</script>
</body>
</html>
